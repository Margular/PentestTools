#!/usr/bin/env python3
# -*- coding:utf-8 -*-

import os
import re

directory = r'E:\迅雷下载\机锋2300W完整版'  #文件夹目录
outpath = r'E:\迅雷下载\gfan.txt'              #整理后文件路径
errorpath = r'E:\迅雷下载\gfan_error.txt'      #不符合要求的行输出路径
search = r'(.+)~\|\^(.{32}):(.{6})~\|\^(.*)'

outfile = open(outpath, 'w', encoding = 'utf-8')
errorfile = open(errorpath, 'w', encoding = 'utf-8')

for filename in os.listdir(directory):  #遍历文件
    filepath = os.path.join(directory, filename)    #文件路径
    print('处理文件: ' + filepath)
    with open(filepath, encoding = 'utf-8', errors = 'backslashreplace') as file:
        for line in file:
            line = line.strip()
            if line == '' or line.find('"') != -1:      #去掉空行和包含"的行
                continue
            result = re.search(search, line)
            if result:       #满足要求的行
                groups = result.groups()
                for item in groups:
                    if item:
                        item = item.strip()
                    else:
                        item = ""
                outfile.write('"'.join(groups) + '\n')
            else:   #不满足要求的行
                errorfile.write(line + '\n')

errorfile.close()
outfile.close()
